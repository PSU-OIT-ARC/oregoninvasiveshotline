[DEFAULT]
extends = "arcutils:local.base.cfg"

PROJECT.title = "Oregon Invasives Hotline"

; Miscellaneous
ITEMS_PER_PAGE = 25
MESSAGE_TAGS.messages.errors = "danger"
SITE_ID = 1

; Auth
AUTH_USER_MODEL = "users.User"
LOGIN_URL = "login"
LOGIN_REDIRECT_URL = "users-home"

; Caching
; Shared key prefix for all caches
CACHE_KEY_PREFIX = "{PACKAGE}.{ENV}."

; The default cache has to exist, even though we don't use it.
CACHES.default.BACKEND = "django.core.cache.backends.locmem.LocMemCache"
CACHES.default.KEY_PREFIX = "{CACHE_KEY_PREFIX}"

; A cache for recording the existence state of files on disk. The keys
; in this cache should be absolute filesystem paths encoded as UTF-8 and
; then hashed using MD5 (so keys are a consistent length and not too
; long). This cache is used to cache whether things like generated icons
; exist because NFS is sooo slooow.
CACHES.path_exists.BACKEND = "django.core.cache.backends.locmem.LocMemCache"
CACHES.path_exists.KEY_PREFIX = "{CACHE_KEY_PREFIX}"
; Remove entries after 4 hours.
CACHES.path_exists.TIMEOUT = 14400
CACHES.path_exists.OPTIONS.MAX_ENTRIES = 512
; Cull 1/4 of the cache entries when it has MAX_ENTRIES.
CACHES.path_exists.OPTIONS.CULL_FREQUENCY = 4

; Database
DATABASES.default.ENGINE = "django.contrib.gis.db.backends.postgis"
DATABASES.default.ATOMIC_REQUESTS = true

CONTACT_EMAIL = "imapinvasivesoregon@gmail.com"

; Haystack
HAYSTACK_CONNECTIONS.default.ENGINE = "haystack.backends.elasticsearch_backend.ElasticsearchSearchEngine"
HAYSTACK_CONNECTIONS.default.INDEX_NAME = "{PACKAGE}-{ENV}"
HAYSTACK_SIGNAL_PROCESSOR = "haystack.signals.RealtimeSignalProcessor"

; Static files
MEDIA_URL = "/media/"

; Templates
TEMPLATES.0.OPTIONS.context_processors = [
        "django.template.context_processors.debug",
        "django.template.context_processors.request",
        "django.contrib.auth.context_processors.auth",
        "django.contrib.messages.context_processors.messages",
        "django.template.context_processors.media",
        "django.template.context_processors.static",
        "django.template.context_processors.tz",
        "arcutils.context_processors.defaults",
        "{PACKAGE}.context_processors.defaults"
    ]

INSTALLED_APPS = [
        "django.contrib.admin",
        "django.contrib.auth",
        "django.contrib.contenttypes",
        "django.contrib.sessions",
        "django.contrib.messages",
        "django.contrib.staticfiles",
        "django.contrib.sites",
        "django.contrib.flatpages",
        "django.contrib.gis",
        "bootstrapform",
        "arcutils",
        "django_pgcli",
        "haystack",
        "permissions",
        "rest_framework",
        "{PACKAGE}.apps.MainAppConfig",
        "{PACKAGE}.pages",
        "{PACKAGE}.users",
        "{PACKAGE}.species",
        "{PACKAGE}.reports",
        "{PACKAGE}.images",
        "{PACKAGE}.notifications",
        "{PACKAGE}.comments",
        "{PACKAGE}.counties"
    ]

EXTRA.MIDDLEWARE_CLASSES = ["cloak.middleware.CloakMiddleware"]

; User notifications
NOTIFICATIONS.subject = "New {PROJECT[title]} submission for review"
NOTIFICATIONS.from_email = "no-reply@pdx.edu"

; Google Maps
GOOGLE.maps.key = "AIzaSyDRamH3fauUUQow07BOuep8gojIvCiGpm4"
GOOGLE.maps.url = "//maps.googleapis.com/maps/api/js?key={GOOGLE[maps][key]}"

[dev]
HAYSTACK_CONNECTIONS.default.URL = "http://localhost:9200/"

[test]
TEST_RUNNER = "{PACKAGE}.testrunner.TestRunner"
CACHES.path_exists.TIMEOUT = 0
IMPORT_FROM_STRING = ["MOMMY_CUSTOM_FIELDS_GEN"]
MOMMY_CUSTOM_FIELDS_GEN = "mommy_spatial_generators.MOMMY_SPATIAL_FIELDS"
HAYSTACK_CONNECTIONS.default.URL = "http://localhost:9200/"

[stage]
HAYSTACK_CONNECTIONS.default.URL = "http://themis.rc.pdx.edu:9200/"

[prod]
ADMINS = [["Wyatt Baldwin", "wbaldwin@pdx.edu"]]
ALLOWED_HOSTS = ["{PACKAGE}.org", "beta.{PACKAGE}.org"]
HAYSTACK_CONNECTIONS.default.URL = "http://themis.rc.pdx.edu:9200/"
